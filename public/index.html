<html>
<head>
  <title>Cause List</title>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
  <script src="http://causelist.org/js/pure.js"></script>
  <script src="http://causelist.org/js/underscore.js"></script>
</head>
<body>
  <!-- HTML template -->
  <table id="courtlist">
    <tbody>
        <tr class="location">
            <td id="location">
            </td>
            <td>
               <table>
                   <thead>
                        <tr>
                            <th>Court Number</th>
                            <th>Court Code</th>
                            <th>Case Number(s)</th>
                            <th>Names(s)</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="court">
                            <td class="courtnumber"></td>
                            <td class="courtcode"></td>
                            <td class="casenumber"></td>
                            <td class="names"></td>
                            <td class="status"></td>
                        </tr>
                    </tbody>
                </table> 
            </td>
        </tr>
    </tbody>
  </table>

<script>
var courts_directive = {
  'tr.location':{
    'location<-locations':{
      'td#location':'location.location',
      'tr.court':{
          'court<-location.courts':{
              'td.courtnumber':'court.CourtNumber'
          }
      }      
    }
  }
};

$.ajax({
            url         : 'http://causelist.org/data?callback=?',
            dataType    : 'jsonp',
            ifModified  : true,
            success     : function(data){
                                            var shaped = {
                                                            locations : _(data.results).chain()
                                                                        .pluck('Court').uniq()
                                                                        .map(function(location){
                                                                            return {
                                                                                        location    : location,
                                                                                        courts      : _(data.results).filter(function(court){
                                                                                                            return court.Court == location;
                                                                                                      })
                                                                                    }
                                                                        }).value()
                                                            };
                                            $('table#courtlist').render(shaped, courts_directive);
                                        }
        });
</script>
</body>
</html>